<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Tự động gửi quote &amp; highlight đến email mỗi ngày | Ngáo Ngơ</title>
<meta name="keywords" content="" />
<meta name="description" content="Dùng google sheet và google app script để động gửi quote &amp; highlight đến email mỗi ngày giúp tăng thêm động lực">
<meta name="author" content="ngaongo.blog@gmail.com">
<link rel="canonical" href="https://www.ngaongo.com/posts/daily-quote-and-highlight/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.fb2ef1eeb1e0a1a0245c409dca96d6c870621749e86c12226256fbf55a3d0595.css" integrity="sha256-&#43;y7x7rHgoaAkXECdypbWyHBiF0nobBIiYlb79Vo9BZU=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://www.ngaongo.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.ngaongo.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.ngaongo.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.ngaongo.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.ngaongo.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q0TMLZ11X0"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-Q0TMLZ11X0', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Tự động gửi quote &amp; highlight đến email mỗi ngày" />
<meta property="og:description" content="Dùng google sheet và google app script để động gửi quote &amp; highlight đến email mỗi ngày giúp tăng thêm động lực" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ngaongo.com/posts/daily-quote-and-highlight/" />
<meta property="og:image" content="https://www.ngaongo.com/cover.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-07T10:37:51&#43;07:00" />
<meta property="article:modified_time" content="2021-12-07T10:37:51&#43;07:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.ngaongo.com/cover.png" />
<meta name="twitter:title" content="Tự động gửi quote &amp; highlight đến email mỗi ngày"/>
<meta name="twitter:description" content="Dùng google sheet và google app script để động gửi quote &amp; highlight đến email mỗi ngày giúp tăng thêm động lực"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://www.ngaongo.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Tự động gửi quote \u0026 highlight đến email mỗi ngày",
      "item": "https://www.ngaongo.com/posts/daily-quote-and-highlight/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Tự động gửi quote \u0026 highlight đến email mỗi ngày",
  "name": "Tự động gửi quote \u0026 highlight đến email mỗi ngày",
  "description": "Dùng google sheet và google app script để động gửi quote \u0026 highlight đến email mỗi ngày giúp tăng thêm động lực",
  "keywords": [
    
  ],
  "articleBody": "Ý tưởng Khi đọc sách hay lang thang trên mạng mà gặp những câu nói hay ho thì mình hay memo lại. Trước đây mình đã từng nghĩ là memo lại để sau này làm tài liệu gì đó, lôi ra tham khảo. Cũng có lần đã từng nghĩ đến việc, nếu có tool gì đó tự động gửi mỗi ngày một câu cho mình, như là để nhắc lại những gì mình đã đọc và đã thích ở sách báo thì hay biết mấy. Hồi đó định làm app mobile dùng cho mục đích cá nhân, rồi suy nghĩ đến việc dựng database như thế nào, dùng loại gì, UI ra sao. Nhưng chốt lại là có làm đâu, nghĩ ra vậy cho có haha.\nĐợt này việc đang rảnh, có thời gian làm cái nọ cái kia. Nghĩ lại thì thấy đây là một điểm cộng rất lớn của việc mình thay đổi công việc. Thêm vào đó, mình mới được giới thiệu một cái podcast nghe khá ưng của anh “Hiếu TV”, các bạn tìm từ khoá này trên mạng là thấy. Trong podcast đó có một bài nói về việc đọc sách. Anh này đọc chủ yếu dùng kindle, cái gì hay anh highlight lại, sau đó dùng dịch vụ Notion để mỗi ngày tự gửi email một đoạn anh đã highlight. Làm như vậy thì kiến thức mình đã từng đọc qua được ôn luyện lại. Tự dưng thấy hay quá và nghĩ, mình có thể làm được như thế không?\nMình không chỉ đọc mỗi trên kindle, mà còn đọc sách giấy và dùng máy tính để đọc cũng khá nhiều, nên nếu chỉ đồng bộ từ kindle như anh làm thì có vẻ chưa phù hợp. Thêm nữa, Notion là dịch vụ trả phí, chả nhiều lắm, nhưng trước đến giờ mình vẫn khá kị những dịch vụ trả phí subscribe (cái này là suy nghĩ của người nghèo à?).\nNhưng mình vẫn muốn làm cái tương tự. Ngay lập tức mình quay lại với ý tưởng làm một cái app mobile. Tìm hiểu một tí thì thấy là làm được, và cũng tốn một chút thời gian đấy vì mình không có chuyên về lập trình. Sau một hồi ngẫm nghĩ thì cảm giác có gì đó sai sai. Trước khi lao đầu đi làm cái gì, cần phải nghĩ nó có thực sự là cái mình muốn không. Cái mình muốn không phải là một cái app mobile, mà mình muốn một chức năng có thể gửi email nhắc nhở những câu quote hoặc highlight hàng ngày. Chợt nhớ lại là có khi có một tool cực kỳ basic có thể làm được điều mình muốn.\nĐến đây thì lan man tí, một câu chuyện vui về việc nghe yêu cầu của khách hàng. Nghề của mình liên quan đến IT, phải nghe yêu cầu sản phẩm khách hàng mô tả, sau đó thì làm ra cái khách hàng muốn. Nhưng chỉ dừng lại ở đó thôi thì hơi xoàng, đôi khi cần phải biết tư vấn cho khách hàng biết được cái thực sự họ muốn là cái gì nữa. Nhiều khách hàng nói muốn cái a cái b cái c trên trời dưới biển, tính toán nọ kia, nhưng chốt lại cuối cùng có khi chỉ cần một sheet excel là có thể đáp ứng được nhu cầu, chả cần phải hệ thống gì cao sang.\nQuay lại chủ đề, mình cũng nhận thấy là có vẻ google sheet có thể làm được cái mình cần. Start small, fail fast.\nThực hiện Tool mình dùng là google sheet và google app script. Mình sẽ có một sheet kiểu như bên dưới. Khi nào có câu nào hay ho thì viết thêm vào. Nhọc một chút công đoạn nhập liệu, nhưng làm trong thời gian dài nên chắc cũng không sao. Lúc nào có thì thêm, năng nhặt chặt bị. Mình hay ngồi máy tính với cũng hay ghi chép từ trước, nên cũng chả phải vấn đề gì to tát. \n\nCode của app script thì cũng chỉ có khoảng 100 dòng. Mình để ở bên dưới nếu chẳng may có bạn nào đọc bài này và thích dùng. App script có hỗ trợ luôn tính năng trigger. Mình set mỗi ngày nó gửi một lần vào khoảng 8h-9h sáng.\nMỗi ngày code sẽ chọn ngẫu nhiên một dòng để gửi. Tuy nhiên cũng cần phải suy nghĩ một chút về cái gọi là “ngẫu nhiên” này. Nghĩ một lúc thì cũng ra. Tạm thời mình sẽ để nó đơn giản. Có 2 yếu tố mình đưa thêm vào việc chọn quote.\n Đã được gửi gần đây rồi thì thôi không gửi lại nữa (mình set là 30 ngày) Dã được gửi nhiều lần hơn so với trung bình rồi thì tạm thời chưa gửi tiếp, để dành lượt cho quote khác.  Kết quả Tén tèn, mỗi sáng sẽ có mail âm thầm gửi đến kiểu như vầy. Mình sẽ theo dõi một thời gian xem cái thuật toán chọn quote ngẫu nhiên đơn giản kia nó có work khi mà số lượng quote nhiều lên hay không. Chắc sẽ ổn thôi, sai đâu sửa đấy, cây nhà lá vườn mà. Tổng thiệt hại về thời gian đâu đó khoảng 4-5 tiếng, chủ yếu là thời gian ngồi lọ mọ copy\u0026paste code haha. Ngoài việc dùng để gửi quote như mục đích ban đầu, nếu nghi thêm chút nữa có khi còn dùng được vào nhiều việc khác nữa 😆\n\n Code app script 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115  /** * Global param */ var sheet = SpreadsheetApp.getActiveSheet(); var toMails = sheet.getRange(\"B3\").getValue(); var subject = sheet.getRange(\"B4\").getValue(); var quoteStartRow = 7; // First row of quote data to process var numQuote = getTotalNumberOfQuote(); // Number of rows to process var startCol = 1; // Start colume of quote table var numCols = 6; // Nubmer of Colume in quote table  var sumSentCount = sheet.getRange(\"D4\").getValue(); var avgSentCount = sumSentCount / numQuote; var noDuplicateSendDays = sheet.getRange(\"D3\").getValue(); /** * Sends emails with data from the current spreadsheet. */ function run() { var allQuotesData = sheet.getRange(quoteStartRow, startCol, numQuote, numCols).getValues(); var selectedQuote = selectQuote(allQuotesData); sendEmailQuote(selectedQuote); updateAfterSendingEmail(selectedQuote); } // Select quote for today function selectQuote(allQuotesData_) { var maxLoop = 100; var quote; for(var i = 0; i  maxLoop; i++){ var rand = Math.floor(Math.random() * numQuote); quote = allQuotesData_[rand]; // If last sent  today - noDuplicateSendDays - do not sent this quote  var today = new Date(); var timeThres_milisec = noDuplicateSendDays * 24 * 60 * 60 * 1000; if ( quote[3] != \"\" \u0026\u0026 (today.getTime() - quote[3].getTime())  timeThres_milisec ) { continue; } // If this quote is sent many time when compare with avgSentCount - do not sent this quote  if (quote[4] != \"\" \u0026\u0026 quote[4]  avgSentCount) { continue; } break; } return quote; } // Send email function sendEmailQuote(selectedQuote_) { var quote = selectedQuote_[1]; var source = selectedQuote_[2]; var message = quote + \" - \" + source; var htmlBody = buildHtmlBody(quote, source); MailApp.sendEmail(toMails, subject, message, {htmlBody: htmlBody}); } function updateAfterSendingEmail(selectedQuote_) { var rowIndex = selectedQuote_[0] - 1 + quoteStartRow; var lastSentDate = new Date(); var count = 0; if (selectedQuote_[4] != \"\") count = selectedQuote_[4]; var lastSentFormatedDate = Utilities.formatDate(lastSentDate, \"GMT+7\", \"dd/MM/yyyy\") var sendOn = selectedQuote_[5]; if (sendOn == \"\") { sendOn = \"'\" + lastSentFormatedDate; } else { sendOn = sendOn + \"; \" + lastSentFormatedDate; } // update data back to sheet  sheet.getRange(rowIndex, 4).setValue(lastSentDate) sheet.getRange(rowIndex, 5).setValue(count + 1) sheet.getRange(rowIndex, 6).setValue(sendOn) } function buildHtmlBody(quote_, source_) { var msg = ''; msg = msg + quote_ + '\n'; msg = msg + '- ' + source_; return msg; } function getTotalNumberOfQuote(){ var quoteCol = sheet.getRange(\"B:B\").getValues(); var rowNum = 0; var blank = false; for(var row = 0; row  quoteCol.length; row++){ if(quoteCol[row][0] === \"\" \u0026\u0026 !blank){ rowNum = row; blank = true; }else if(quoteCol[row][0] !== \"\"){ blank = false; }; }; return rowNum - quoteStartRow + 1; };   ",
  "wordCount" : "1445",
  "inLanguage": "en",
  "image":"https://www.ngaongo.com/cover.png","datePublished": "2021-12-07T10:37:51+07:00",
  "dateModified": "2021-12-07T10:37:51+07:00",
  "author":{
    "@type": "Person",
    "name": "ngaongo.blog@gmail.com"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.ngaongo.com/posts/daily-quote-and-highlight/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ngáo Ngơ",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.ngaongo.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.ngaongo.com/" accesskey="h" title="Ngáo Ngơ (Alt + H)">Ngáo Ngơ</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.ngaongo.com/archives" title="List">
                    <span>List</span>
                </a>
            </li>
            <li>
                <a href="https://www.ngaongo.com/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://www.ngaongo.com/manifesto/" title="Manifesto">
                    <span>Manifesto</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.ngaongo.com/">Home</a>&nbsp;»&nbsp;<a href="https://www.ngaongo.com/posts/">Posts</a></div>
    <h1 class="post-title">
      Tự động gửi quote &amp; highlight đến email mỗi ngày
    </h1>
    <div class="post-description">
      Dùng google sheet và google app script để động gửi quote &amp; highlight đến email mỗi ngày giúp tăng thêm động lực
    </div>
    <div class="post-meta"><span title='2021-12-07 10:37:51 +0700 +07'>December 7, 2021</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;ngaongo.blog@gmail.com

</div>
  </header> 
<figure class="entry-cover">
        <img loading="lazy" srcset="https://www.ngaongo.com/posts/daily-quote-and-highlight/cover_hub4ed4c9cc7eb1ad24631a1a4bfed940f_6744034_360x0_resize_box_3.png 360w ,https://www.ngaongo.com/posts/daily-quote-and-highlight/cover_hub4ed4c9cc7eb1ad24631a1a4bfed940f_6744034_480x0_resize_box_3.png 480w ,https://www.ngaongo.com/posts/daily-quote-and-highlight/cover_hub4ed4c9cc7eb1ad24631a1a4bfed940f_6744034_720x0_resize_box_3.png 720w ,https://www.ngaongo.com/posts/daily-quote-and-highlight/cover_hub4ed4c9cc7eb1ad24631a1a4bfed940f_6744034_1080x0_resize_box_3.png 1080w ,https://www.ngaongo.com/posts/daily-quote-and-highlight/cover_hub4ed4c9cc7eb1ad24631a1a4bfed940f_6744034_1500x0_resize_box_3.png 1500w ,https://www.ngaongo.com/posts/daily-quote-and-highlight/cover.png 2168w" 
            sizes="(min-width: 768px) 720px, 100vw" src="https://www.ngaongo.com/posts/daily-quote-and-highlight/cover.png" alt="cover photo" 
            width="2168" height="1062">
        
</figure>
  <div class="post-content"><h2 id="ý-tưởng">Ý tưởng<a hidden class="anchor" aria-hidden="true" href="#ý-tưởng">#</a></h2>
<p>Khi đọc sách hay lang thang trên mạng mà gặp những câu nói hay ho thì mình hay memo lại.
Trước đây mình đã từng nghĩ là memo lại để sau này làm tài liệu gì đó, lôi ra tham khảo.
Cũng có lần đã từng nghĩ đến việc, nếu có tool gì đó tự động gửi mỗi ngày một câu cho mình, như là để nhắc lại những gì mình đã đọc và đã thích ở sách báo thì hay biết mấy. Hồi đó định làm app mobile dùng cho mục đích cá nhân, rồi suy nghĩ đến việc dựng database như thế nào, dùng loại gì, UI ra sao. Nhưng chốt lại là có làm đâu, nghĩ ra vậy cho có haha.</p>
<p>Đợt này việc đang rảnh, có thời gian làm cái nọ cái kia. Nghĩ lại thì thấy đây là một điểm cộng rất lớn của việc mình thay đổi công việc. Thêm vào đó, mình mới được giới thiệu một cái podcast nghe khá ưng của anh &ldquo;Hiếu TV&rdquo;, các bạn tìm từ khoá này trên mạng là thấy. Trong podcast đó có một bài nói về việc đọc sách. Anh này đọc chủ yếu dùng kindle, cái gì hay anh highlight lại, sau đó dùng dịch vụ Notion để mỗi ngày tự gửi email một đoạn anh đã highlight. Làm như vậy thì kiến thức mình đã từng đọc qua được ôn luyện lại. Tự dưng thấy hay quá và nghĩ, mình có thể làm được như thế không?</p>
<p>Mình không chỉ đọc mỗi trên kindle, mà còn đọc sách giấy và dùng máy tính để đọc cũng khá nhiều, nên nếu chỉ đồng bộ từ kindle như anh làm thì có vẻ chưa phù hợp. Thêm nữa, Notion là dịch vụ trả phí, chả nhiều lắm, nhưng trước đến giờ mình vẫn khá kị những dịch vụ trả phí subscribe (cái này là suy nghĩ của người nghèo à?).</p>
<p>Nhưng mình vẫn muốn làm cái tương tự. Ngay lập tức mình quay lại với ý tưởng làm một cái app mobile.
Tìm hiểu một tí thì thấy là làm được, và cũng tốn một chút thời gian đấy vì mình không có chuyên về lập trình.
Sau một hồi ngẫm nghĩ thì cảm giác có gì đó sai sai. Trước khi lao đầu đi làm cái gì, cần phải nghĩ nó có thực sự là cái mình muốn không.
Cái mình muốn không phải là một cái app mobile, mà mình muốn một chức năng có thể gửi email nhắc nhở những câu quote hoặc highlight hàng ngày. Chợt nhớ lại là có khi có một tool cực kỳ basic có thể làm được điều mình muốn.</p>
<p>Đến đây thì lan man tí, một câu chuyện vui về việc nghe yêu cầu của khách hàng. Nghề của mình liên quan đến IT, phải nghe yêu cầu sản phẩm khách hàng mô tả, sau đó thì làm ra cái khách hàng muốn. Nhưng chỉ dừng lại ở đó thôi thì hơi xoàng, đôi khi cần phải biết tư vấn cho khách hàng biết được cái thực sự họ muốn là cái gì nữa. Nhiều khách hàng nói muốn cái a cái b cái c trên trời dưới biển, tính toán nọ kia, nhưng chốt lại cuối cùng có khi chỉ cần một sheet excel là có thể đáp ứng được nhu cầu, chả cần phải hệ thống gì cao sang.</p>
<p>Quay lại chủ đề, mình cũng nhận thấy là có vẻ google sheet có thể làm được cái mình cần. Start small, fail fast.</p>
<h2 id="thực-hiện">Thực hiện<a hidden class="anchor" aria-hidden="true" href="#thực-hiện">#</a></h2>
<p>Tool mình dùng là google sheet và google app script.
Mình sẽ có một sheet kiểu như bên dưới. Khi nào có câu nào hay ho thì viết thêm vào. Nhọc một chút công đoạn nhập liệu, nhưng làm trong thời gian dài nên chắc cũng không sao. Lúc nào có thì thêm, năng nhặt chặt bị. Mình hay ngồi máy tính với cũng hay ghi chép từ trước, nên cũng chả phải vấn đề gì to tát.
 
<figure class="entry-cover">
            <img loading="lazy" srcset=" https://www.ngaongo.com/posts/daily-quote-and-highlight/sheet_hu535461fc6f6849272272bcf155bd7d54_103057_640x0_resize_box_3.png 640w ,   https://www.ngaongo.com/posts/daily-quote-and-highlight/sheet_hu535461fc6f6849272272bcf155bd7d54_103057_768x0_resize_box_3.png 768w ,   https://www.ngaongo.com/posts/daily-quote-and-highlight/sheet_hu535461fc6f6849272272bcf155bd7d54_103057_1024x0_resize_box_3.png 1024w ,   https://www.ngaongo.com/posts/daily-quote-and-highlight/sheet_hu535461fc6f6849272272bcf155bd7d54_103057_1366x0_resize_box_3.png 1366w ,  https://www.ngaongo.com/posts/daily-quote-and-highlight/sheet.png 1457w " 
            sizes="(min-width: 768px) 720px, 100vw" src="https://www.ngaongo.com/posts/daily-quote-and-highlight/sheet.png" alt="sheet template" width="1457" height="458"> 

    
    <p></p>
</figure></p>
<p>Code của app script thì cũng chỉ có khoảng 100 dòng. Mình để ở bên dưới nếu chẳng may có bạn nào đọc bài này và thích dùng.
App script có hỗ trợ luôn tính năng trigger. Mình set mỗi ngày nó gửi một lần vào khoảng 8h-9h sáng.</p>
<p>Mỗi ngày code sẽ chọn ngẫu nhiên một dòng để gửi. Tuy nhiên cũng cần phải suy nghĩ một chút về cái gọi là &ldquo;ngẫu nhiên&rdquo; này.
Nghĩ một lúc thì cũng ra. Tạm thời mình sẽ để nó đơn giản. Có 2 yếu tố mình đưa thêm vào việc chọn quote.</p>
<ul>
<li>Đã được gửi gần đây rồi thì thôi không gửi lại nữa (mình set là 30 ngày)</li>
<li>Dã được gửi nhiều lần hơn so với trung bình rồi thì tạm thời chưa gửi tiếp, để dành lượt cho quote khác.</li>
</ul>
<h2 id="kết-quả">Kết quả<a hidden class="anchor" aria-hidden="true" href="#kết-quả">#</a></h2>
<p>Tén tèn, mỗi sáng sẽ có mail âm thầm gửi đến kiểu như vầy. Mình sẽ theo dõi một thời gian xem cái thuật toán chọn quote ngẫu nhiên đơn giản kia nó có <em>work</em> khi mà số lượng quote nhiều lên hay không. Chắc sẽ ổn thôi, sai đâu sửa đấy, cây nhà lá vườn mà. Tổng thiệt hại về thời gian đâu đó khoảng 4-5 tiếng, chủ yếu là thời gian ngồi lọ mọ copy&amp;paste code haha. Ngoài việc dùng để gửi quote như mục đích ban đầu, nếu nghi thêm chút nữa có khi còn dùng được vào nhiều việc khác nữa 😆</p>
 
<figure class="entry-cover">
            <img loading="lazy" srcset=" https://www.ngaongo.com/posts/daily-quote-and-highlight/result_hufd61d4d98d607f8e9b8297bb9d38edf2_857063_640x0_resize_box_3.png 640w ,  https://www.ngaongo.com/posts/daily-quote-and-highlight/result.png 734w " 
            sizes="(min-width: 768px) 720px, 100vw" src="https://www.ngaongo.com/posts/daily-quote-and-highlight/result.png" alt="sample email notification" width="734" height="572"> 

    
    <p></p>
</figure>
<h2 id="code-app-script">Code app script<a hidden class="anchor" aria-hidden="true" href="#code-app-script">#</a></h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Global param
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SpreadsheetApp</span>.<span style="color:#a6e22e">getActiveSheet</span>();
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">toMails</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;B3&#34;</span>).<span style="color:#a6e22e">getValue</span>();
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">subject</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;B4&#34;</span>).<span style="color:#a6e22e">getValue</span>();


<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">quoteStartRow</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>; <span style="color:#75715e">// First row of quote data to process
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">numQuote</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getTotalNumberOfQuote</span>(); <span style="color:#75715e">// Number of rows to process
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">startCol</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">// Start colume of quote table
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">numCols</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;  <span style="color:#75715e">// Nubmer of Colume in quote table
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sumSentCount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;D4&#34;</span>).<span style="color:#a6e22e">getValue</span>();
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">avgSentCount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sumSentCount</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">numQuote</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">noDuplicateSendDays</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;D3&#34;</span>).<span style="color:#a6e22e">getValue</span>();


<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Sends emails with data from the current spreadsheet.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">run</span>() {

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">allQuotesData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#a6e22e">quoteStartRow</span>, <span style="color:#a6e22e">startCol</span>, <span style="color:#a6e22e">numQuote</span>, <span style="color:#a6e22e">numCols</span>).<span style="color:#a6e22e">getValues</span>();
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">selectedQuote</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectQuote</span>(<span style="color:#a6e22e">allQuotesData</span>);

  <span style="color:#a6e22e">sendEmailQuote</span>(<span style="color:#a6e22e">selectedQuote</span>);

  <span style="color:#a6e22e">updateAfterSendingEmail</span>(<span style="color:#a6e22e">selectedQuote</span>);
}

<span style="color:#75715e">// Select quote for today
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">selectQuote</span>(<span style="color:#a6e22e">allQuotesData_</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">maxLoop</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">quote</span>;
  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">maxLoop</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>){
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rand</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#a6e22e">numQuote</span>);
    <span style="color:#a6e22e">quote</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">allQuotesData_</span>[<span style="color:#a6e22e">rand</span>];

    <span style="color:#75715e">// If last sent &gt; today -  noDuplicateSendDays -&gt; do not sent this quote
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">today</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">timeThres_milisec</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">noDuplicateSendDays</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>;
    <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">quote</span>[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">&amp;&amp;</span> 
        (<span style="color:#a6e22e">today</span>.<span style="color:#a6e22e">getTime</span>() <span style="color:#f92672">-</span> <span style="color:#a6e22e">quote</span>[<span style="color:#ae81ff">3</span>].<span style="color:#a6e22e">getTime</span>()) <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">timeThres_milisec</span> ) {
      <span style="color:#66d9ef">continue</span>;
    }
    
    <span style="color:#75715e">// If this quote is sent many time when compare with avgSentCount -&gt; do not sent this quote
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">quote</span>[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">quote</span>[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">avgSentCount</span>) {
      <span style="color:#66d9ef">continue</span>;
    }
    
    <span style="color:#66d9ef">break</span>;

  }
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">quote</span>;
}


<span style="color:#75715e">// Send email
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sendEmailQuote</span>(<span style="color:#a6e22e">selectedQuote_</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">quote</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedQuote_</span>[<span style="color:#ae81ff">1</span>]; 
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">source</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedQuote_</span>[<span style="color:#ae81ff">2</span>];
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span>  <span style="color:#a6e22e">quote</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; - &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">source</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">htmlBody</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">buildHtmlBody</span>(<span style="color:#a6e22e">quote</span>, <span style="color:#a6e22e">source</span>);
  <span style="color:#a6e22e">MailApp</span>.<span style="color:#a6e22e">sendEmail</span>(<span style="color:#a6e22e">toMails</span>, <span style="color:#a6e22e">subject</span>, <span style="color:#a6e22e">message</span>, {<span style="color:#a6e22e">htmlBody</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">htmlBody</span>});
}


<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">updateAfterSendingEmail</span>(<span style="color:#a6e22e">selectedQuote_</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rowIndex</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedQuote_</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">quoteStartRow</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">lastSentDate</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">selectedQuote_</span>[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedQuote_</span>[<span style="color:#ae81ff">4</span>];

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">lastSentFormatedDate</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Utilities</span>.<span style="color:#a6e22e">formatDate</span>(<span style="color:#a6e22e">lastSentDate</span>, <span style="color:#e6db74">&#34;GMT+7&#34;</span>, <span style="color:#e6db74">&#34;dd/MM/yyyy&#34;</span>)
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sendOn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">selectedQuote_</span>[<span style="color:#ae81ff">5</span>];
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sendOn</span> <span style="color:#f92672">==</span>  <span style="color:#e6db74">&#34;&#34;</span>) {
    <span style="color:#a6e22e">sendOn</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#39;&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">lastSentFormatedDate</span>;
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">sendOn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sendOn</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">lastSentFormatedDate</span>;
  }

  <span style="color:#75715e">// update data back to sheet
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#a6e22e">rowIndex</span>, <span style="color:#ae81ff">4</span>).<span style="color:#a6e22e">setValue</span>(<span style="color:#a6e22e">lastSentDate</span>)
  <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#a6e22e">rowIndex</span>, <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">setValue</span>(<span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
  <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#a6e22e">rowIndex</span>, <span style="color:#ae81ff">6</span>).<span style="color:#a6e22e">setValue</span>(<span style="color:#a6e22e">sendOn</span>)
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">buildHtmlBody</span>(<span style="color:#a6e22e">quote_</span>, <span style="color:#a6e22e">source_</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">msg</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;h3&gt;&#39;</span>;
  <span style="color:#a6e22e">msg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">msg</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">quote_</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&lt;/h3&gt;&lt;br&gt;&#39;</span>;
  <span style="color:#a6e22e">msg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">msg</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;- &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">source_</span>;
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">msg</span>;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getTotalNumberOfQuote</span>(){
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">quoteCol</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sheet</span>.<span style="color:#a6e22e">getRange</span>(<span style="color:#e6db74">&#34;B:B&#34;</span>).<span style="color:#a6e22e">getValues</span>();

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rowNum</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">blank</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;

  <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">row</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">row</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">quoteCol</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>){
    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">quoteCol</span>[<span style="color:#a6e22e">row</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">blank</span>){
      <span style="color:#a6e22e">rowNum</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">row</span>;
      <span style="color:#a6e22e">blank</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
    }<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">quoteCol</span>[<span style="color:#a6e22e">row</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;&#34;</span>){
      <span style="color:#a6e22e">blank</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
    };
  };

  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rowNum</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">quoteStartRow</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
};
</code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="prev" href="https://www.ngaongo.com/posts/deep-work/">
    <span class="title">« Prev Page</span>
    <br>
    <span>Deep work</span>
  </a>
  <a class="next" href="https://www.ngaongo.com/posts/cau-chuyen-cai-chao/">
    <span class="title">Next Page »</span>
    <br>
    <span>Câu chuyện cái chảo</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.ngaongo.com/">Ngáo Ngơ</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
